IMWEB_WEBPACK['WebRTCAPI_edu_v1'] = true; function IMWEB_WEBPACK_WebRTCAPI_edu_v1() {
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,n){"use strict";var r=n(7),i=n(3),o=n(1),a=n(8).WS_CMD,s=n(16),c=n(2),d=n(4).emitter,p=c.EVENT,u=function(e){this.global=e,this.playerMonitors={},this.preReportQualityTime=Date.now(),this.preCheckCatonTime=Date.now(),this.triggerTimes=0,this.createTimer()};u.fn=u.prototype,u.fn.wsSendMsg=function(e){if(this.global.websocket)try{this.global.websocket.send(JSON.stringify(e))}catch(e){o.info("websocket send error, "+e.message)}},u.fn.getDecInfo=function(e){var t={streamid:"",streamurl:"",audio:{ssrc:0,codec:"",packetsReceived:0,bytesReceived:0,packetsLost:0},video:{ssrc:0,codec:"",packetsReceived:0,bytesReceived:0,packetsLost:0,width:0,height:0,framesDecoded:0,framesReceived:0}},n=this.global;return n.detectRTCResult&&n.detectRTCResult.isSafari?e.results.forEach(function(e){if("inbound-rtp"===e.type){"video"===e.mediaType||-1!==e.id.indexOf("RTCInboundRTPVideoStream")?(t.video.ssrc=e.ssrc,t.video.codec=e.googCodecName,t.video.packetsReceived=parseInt(e.packetsReceived),t.video.packetsLost=parseInt(e.packetsLost),t.video.bytesReceived=parseInt(e.bytesReceived),e.googInterframeDelayMax&&(t.video.interFrameDelayMax=parseInt(e.googInterframeDelayMax))):(t.audio.ssrc=e.ssrc,t.audio.codec="unknown",t.audio.bytesReceived=parseInt(e.bytesReceived),t.audio.packetsLost=parseInt(e.packetsLost),t.audio.packetsReceived=parseInt(e.packetsReceived))}else"track"===e.type&&-1!==e.id.indexOf("RTCMediaStreamTrack_receiver")?e.frameWidth>0&&(t.video.width=parseInt(e.frameHeight),t.video.height=parseInt(e.frameWidth),t.video.framesDecoded=parseInt(e.framesDecoded),t.video.framesReceived=parseInt(e.framesReceived)):e.type}):e.results.forEach(function(e){if("ssrc"===e.type){var n="video"===e.mediaType;-1!==e.id.indexOf("_recv")&&(n?(t.video.ssrc=e.ssrc,t.video.codec=e.googCodecName,t.video.bytesReceived=parseInt(e.bytesReceived),t.video.packetsReceived=parseInt(e.packetsReceived),t.video.packetsLost=parseInt(e.packetsLost),t.video.width=parseInt(e.googFrameWidthReceived),t.video.height=parseInt(e.googFrameHeightReceived),t.video.framesDecoded=parseInt(e.googFrameRateDecoded),t.video.framesReceived=parseInt(e.googFrameRateReceived),e.googInterframeDelayMax&&(t.video.interFrameDelayMax=parseInt(e.googInterframeDelayMax))):(t.audio.ssrc=e.ssrc,t.audio.codec=e.googCodecName,t.audio.packetsReceived=parseInt(e.packetsReceived),t.audio.packetsLost=parseInt(e.packetsLost),t.audio.bytesReceived=parseInt(e.bytesReceived)))}}),t},u.fn.reportQuality=function(){var e=this.global,t=this,n=Object.keys(e.peerConnections).length,r=0,c={cmd:a.REPORT_QUALITY,content:{beginUtime:0,endUtime:0,decInfos:[]}};if(c.content.endUtime=(new Date).getTime()+"",e.preReportUtime?c.content.beginUtime=e.preReportUtime:c.content.beginUtime=(new Date).getTime()+"",e.preReportUtime=c.content.endUtime,0==n)return void t.wsSendMsg(c);for(var u in e.peerConnections){var l=e.peerConnections[u];!function(e){s(e,function(a){e.stats=a;var s=t.getDecInfo(e.stats);s.streamid=e.streamId,s.streamurl=e.streamUrl;var u=i.cloneObj(s);e.decInfo?(u.audio&&e.decInfo.audio&&(u.audio.bytesReceived-=e.decInfo.audio.bytesReceived,u.audio.packetsReceived-=e.decInfo.audio.packetsReceived,u.audio.packetsLost-=e.decInfo.audio.packetsLost),u.video&&e.decInfo.video&&(u.video.bytesReceived-=e.decInfo.video.bytesReceived,u.video.packetsReceived-=e.decInfo.video.packetsReceived,u.video.packetsLost-=e.decInfo.video.packetsLost),!e.catonStat||e.preCatonStat&&e.preCatonStat.loadingDuration==e.catonStat.loadingDuration&&e.preCatonStat.loadingTimes==e.catonStat.loadingTimes||(e.preCatonStat=e.catonStat,u.catonStat=e.catonStat,o.debug("reportDecInfo.catonStat:"+JSON.stringify(u.catonStat))),e.decInfo=i.cloneObj(s)):(u=i.cloneObj(s),e.decInfo=i.cloneObj(s)),c.content.decInfos.push(u),d.emit("onEvent",{type:p.STREAM_QUALITY,content:{decInfo:u}}),++r==n&&t.wsSendMsg(c)})}(l)}},u.fn.endReport=function(e){var t=(this.global,this),n={cmd:a.END_REPORT,content:{begineUtime:0,endUtime:0,streamQuality:[]}};n.content.begineUtime=e.createUtime,n.content.endUtime=(new Date).getTime(),e.stats||retrun;var r=i.cloneObj(e.stats);o.debug("decInfo:",t.parseStats(r));var s=[];r.results.forEach(function(e){"ssrc"===e.type&&-1!==e.id.indexOf("_recv")&&s.push(e)}),n.content.streamQuality.push({streamId:streamId,items:s}),t.wsSendMsg(n)},u.fn.reportSSO=function(e){var t=this.global;e.env||(e.env=c.HOST_NAME,t.websocket.isbkurl&&(e.env=c.BK_HOST_NAME));r.post("https://yun.tim.qq.com/v5/AVQualityReportSvc/C2S?sdkappid=1&cmdtype=live_jssdk",JSON.stringify(e),{parseJson:!1}).catch(function(e){console.error("report to sso error: ",e)})},u.fn.addPlayerMonitor=function(e,t){e&&t&&(this.playerMonitors[e]&&(o.debug("[addPlayerMonitor] remove, videoId:"+this.playerMonitors[e].videoId),this.playerMonitors[e].destroy(),delete this.playerMonitors[e]),this.playerMonitors[e]=new l(e,t),this.playerMonitors[e].start(),o.debug("[addPlayerMonitor] add, videoId:"+this.playerMonitors[e].videoId))},u.fn.removePlayerMonitor=function(e){e&&this.playerMonitors[e]&&(o.debug("[removePlayerMonitor] remove, videoId:"+this.playerMonitors[e].videoId),this.playerMonitors[e].destroy(),delete this.playerMonitors[e])},u.fn.checkCaton=function(){var e=this;for(var t in e.playerMonitors){var n=e.playerMonitors[t];n&&n.checkCaton()}},u.fn.createReportQualityTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,t=this;setInterval(function(){t.reportQuality()},e)},u.fn.createPlayMonitorTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=this;setInterval(function(){t.checkCaton()},e)},u.fn.createTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=this;setInterval(function(){t.triggerTimes++;var n=Date.now();t.triggerTimes*e>=2e3&&(t.triggerTimes=0,t.preReportQualityTime=n,t.reportQuality()),t.preCheckCatonTime=n,t.checkCaton()},e)};var l=function(e,t){this.videoId=t,this.streamUrl=e,this.startTime=Date.now(),this.loadMetaDataTime=0,this.firstPlayingTime=0,this.playingTime=0,this.paused=!0,this.watchedTime=0,this.ended=0,this.destroyed=0,this.catonTimer=null,this.timePoint={},this.pointCache=[],this.loadingDuration=0,this.isWaiting=!1,this.loadingTimes=0,this.onloadedmetadata=function(){this.loadMetaDataTime=Date.now(),console.log("loadMetaData UseTime:"+(this.loadMetaDataTime-this.startTime))},this.onplaying=function(){var e=this;this.paused=!1,0==this.firstPlayingTime&&(this.firstPlayingTime=Date.now(),console.log("firstPlaying UseTime:"+(this.firstPlayingTime-this.startTime)),d.emit("onEvent",{type:p.FIRST_FRAME_USETIME,content:{streamUrl:e.streamUrl,startTime:e.startTime,loadMetaDataTime:e.loadMetaDataTime,firstPlayingTime:e.firstPlayingTime}}))},this.ontimeupdate=function(e){this.watchedTime=e&&(e.watchedTime/1e3||e.timeStamp/1e3)||0},this.onpause=function(){this.paused=!0},this.onsuspend=function(){clearInterval(this.catonTimer)},this.onerror=function(){this.onpause()},this.onended=function(){this.onpause()},this.checkCaton=function(){var e=this;if(e.paused)return!1;e.pointCache.length>50&&e.pointCache.pop();var t=Date.now();if(e.pointCache.unshift({watchedTime:this.watchedTime,curTime:t}),e.pointCache[1]&&e.watchedTime-e.pointCache[1].watchedTime<=0){for(var n=-1,r=0;r<e.pointCache.length;r++)if(t-e.pointCache[r].curTime>5e3){n=r;break}if(n>=0){var i=(e.watchedTime-e.pointCache[n].watchedTime)/(n+1);if(o.debug("diffWatchTime:"+i),i<=.4)return e.isWaiting||(e.loadingTimes+=1),e.loadingDuration+=1,e.isWaiting=!0,d.emit("onEvent",{type:p.CHECK_CATON,content:{streamUrl:e.streamUrl,startUTime:e.startTime,checkUtime:Date.now(),loadingDuration:e.loadingDuration,loadingTimes:e.loadingTimes}}),!0}}return e.isWaiting=!1,!1},this.setTimePoint=function(e){return!this.timePoint[e]&&(this.timePoint[e]=Date.now(),!0)};var n=this,r=function(){o.info("video["+e+"] onloadedmetadata"),n.onloadedmetadata()},i=function(){o.info("video["+e+"] onplaying"),n.onplaying()},a=function(e){n.ontimeupdate(e)},s=function(){o.info("video["+e+"] onerror"),n.onerror()},c=function(){o.info("video["+e+"] onended"),n.onended()},u=function(){o.info("video["+e+"] onsuspend"),n.onsuspend()},l=function(){o.info("video["+e+"] onpause"),n.onpause()};this.start=function(){var e=document.getElementById(n.videoId);if(!e)return void o.error("start, get video element failed!");o.debug("start, get video element succ!"),e.addEventListener("loadedmetadata",r),e.addEventListener("playing",i),e.addEventListener("timeupdate",a),e.addEventListener("error",s),e.addEventListener("ended",c),e.addEventListener("suspend",u),e.addEventListener("pause",l)},this.destroy=function(){var e=document.getElementById(n.videoId);if(!e)return void o.debug("destroy, get video element failed!");o.debug("destroy, get video element succ!"),e.removeEventListener("loadedmetadata",r),e.removeEventListener("playing",i),e.removeEventListener("timeupdate",a),e.removeEventListener("error",s),e.removeEventListener("ended",c),e.removeEventListener("suspend",u),e.removeEventListener("pause",l)}},f=function(e){r.post(c.SSO_URL,JSON.stringify(e),{parseJson:!1}).catch(function(e){console.error("report to sso error: ",e)})},m={WS_OPEN:"WSOpen",WS_CLOSE:"WSClose",LOCAL_SDP:"LocalSdp",LOCAL_CANDIDATE:"LocalCandidate",REMOTE_SDP:"RemoteSdp",ICE_CONN:"IceConn"},v={SUCC:"0",FAILED:"1"},h={COMPLETE:"0",CONNECTED:"1",DISCONN:"2",FAILED:"3",CLOSE:"4"};e.exports.Report=u,e.exports.reportSSO=f,e.exports.SSO_REPORT_TYPE=m,e.exports.SSO_ERR_CODE=v,e.exports.SSO_ICE_STAT=h},function(e,t,n){"use strict";function r(e,t){var n="";try{if(!s.WEBRTC_CGI_URL)return void console.warn("CGI URL not ready!");var r=TXWebRTCAPI.global;n=JSON.stringify({type:"webrtc_live",sessionid:r.sessionid,localip:r.localip,signalip:r.signalip,obj:t?JSON.stringify(t):"",log:e}),a.post(s.WEBRTC_CGI_URL,"data="+escape(n),{parseJson:!1}).catch(function(e){})}catch(e){}}function i(){var e=document.createElement("script");e.src="//sqimg.qq.com/expert_qq/vConsole/vconsole.min.js",document.body.appendChild(e),e.onload=function(){window.vConsole=new VConsole}}var o=n(3),a=n(7),s=n(2),c=s.localLogOn,d=s.remoteLogOn,p=new function(){var e="WEBRTC_API : ";o.query("debug")&&i(),this.error=function(t,n){d&&r("[ERROR]"+t,n),c&&(n?console.error(e+t,n):console.error(e+t))},this.debug=function(t,n){c&&(n?console.log(e+t,n):console.log(e+t))},this.info=function(t,n){d&&r("[INFO]"+t,n),c&&(n?console.info(e+t,n):console.info(e+t))},this.warn=function(t,n){d&&r("[WARN]"+t,n),c&&(n?console.warn(e+t,n):console.warn(e+t))}};e.exports=p},function(e,t,n){"use strict";var r={Version:"1.0.0",remoteLogOn:!0,localLogOn:!0,WEBRTC_CGI_URL:"https://live.rtc.qq.com:8687/api/uploadlog",HOST_NAME:"live.rtc.qq.com",WS_URL:"wss://live.rtc.qq.com:8687",BK_WEBRTC_CGI_URL:"https://live5.rtc.qq.com:8687/api/uploadlog",BK_HOST_NAME:"live5.rtc.qq.com",BK_WS_URL:"wss://live5.rtc.qq.com:8687",SSO_URL:"https://yun.tim.qq.com/v5/AVQualityReportSvc/C2S?sdkappid=1&cmdtype=live_jssdk",WS_MAX_RETRY_COUNT:3,WS_RETRY_DIST:3e3,REPORT_QUALITY_INTERVAL_TIME:2e3,EVENT:{CLIENT_DETECT:"client_detect",SESSION_ID:"session_id",WS_STATE:"ws_state",ICE_STATE:"ice_state",STREAM_STATE:"stream_state",STREAM_QUALITY:"stream_quality",FIRST_FRAME_USETIME:"first_frame_usetime",CHECK_CATON:"check_caton",ICE_STATE_REPORT:"ice_state_report"},WEBRTC_STUN_SERVER:"",SdpSemantics:"unified-plan",PEERC_OPTIONAL:{optional:[{DtlsSrtpKeyAgreement:!0}]},getPeerCConfig:function(){var e={iceServers:[],bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost",sdpSemantics:r.SdpSemantics};return r.WEBRTC_STUN_SERVER&&(e.iceServers=[{urls:r.WEBRTC_STUN_SERVER}]),e},SDP_OPTION:{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1},setHostname:function(e){this.HOST_NAME=e,this.WS_URL="wss://"+e+":8687",this.WEBRTC_CGI_URL="https://"+e+":8687/api/uploadlog"},setBkHostname:function(e){this.BK_HOST_NAME=e,this.BK_WS_URL="wss://"+e+":8687",this.BK_WEBRTC_CGI_URL="https://"+e+":8687/api/uploadlog"}};e.exports=r},function(e,t,n){"use strict";function r(e){var t=i(e),n=i("10.0.0.0"),r=i("10.255.255.255"),a=i("172.16.0.0"),s=i("172.31.255.255"),c=i("192.168.0.0"),d=i("192.168.255.255"),p=i("127.0.0.0"),u=i("127.255.255.255");return o(t,n,r)||o(t,a,s)||o(t,c,d)||o(t,p,u)}function i(e){var t=e.split(".");return 256*parseInt(t[0])*256*256+256*parseInt(t[1])*256+256*parseInt(t[2])+parseInt(t[3])}function o(e,t,n){return e>=t&&e<=n}function a(e){var t=/^(?:webrtc:\/\/)(?:[0-9.\-A-Za-z_]+)(?:\/)(?:[0-9.\-A-Za-z_]+)(?:\/)([^?#]*)(?:\?*)(?:[^?#]*)/,n=t.exec(e);return n?n[1]:null}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c={query:function(e){var t=window.location.search.match(new RegExp("(\\?|&)"+e+"=([^&]*)(&|$)"));return t?decodeURIComponent(t[2]):""},getHash:function(e){var t=window.location.hash.match(new RegExp("(#|&)"+e+"=([^&]*)(&|$)"));return t?decodeURIComponent(t[2]):""},cloneObj:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t,n=e.constructor===Array?[]:{};if("object"===(void 0===e?"undefined":s(e))){if(window.JSON)t=JSON.stringify(e),n=JSON.parse(t);else for(var r in e)n[r]="object"===s(e[r])?cloneObj(e[r]):e[r];return n}}),takeSnapshot:function(e,t){var n=this;return function(t){var n=document.createElement("canvas");n.width=t.videoWidth||t.clientWidth,n.height=t.videoHeight||t.clientHeight,n.getContext("2d").drawImage(t,0,0,n.width,n.height),e&&e(n.toDataURL("image/png"))}(n)},isInnerIPFn:r,getStreamId:a};HTMLVideoElement.prototype.takeSnapshot=c.takeSnapshot,e.exports=c},function(e,t,n){"use strict";function r(e){o.debug("[EmmitterUtil][onAddStream]",e)}var i=n(17),o=n(1),a=i(),s={};s.onAddStream=r,a.on("*",function(e,t){s[e]&&s[e](t)}),e.exports.emitter=a,e.exports.emitterHandler=s},function(e,t,n){"use strict";var r={SUCC:0,NOT_SUPPORT:1,INIT_WS_FAILED:10001,WS_CLOSE:10002,WS_ERROR:10003,ICE_COMPLETE:10004,ICE_CLOSE:10005,ICE_DISCONN:10006,STREAM_URL_INVALID:10014,PULL_STREAM_FAIL:10015,SET_REMOTE_SDP_FAIL:10016,GET_LOCAL_SDP_FAIL:10017,RM_STREAM_USER_EXIT:10018,RM_STREAM_PCEVENT:10019,RM_STREAM_USER_STOP:10020},i={SUCC:0,USER_NOT_EXIST:20001,STREAM_URL_INVALID:20002,STREAM_URL_EXIST:20003,GET_AUTH_ADDR_FAIL:20004,GET_RELAY_FAIL:20005,STREAM_NOT_EXIST:20006,RSP_CMD_INVALID:20007,REQ_TO_RELAY_FAIL:20008,RELAY_USER_TIMEOUT:20009,RELAY_DEL_PC_UNKNOW:20010,RELAY_DEL_PC_ABNORMAL:20011,RELAY_DEL_PC_END:20012,RELAY_DEL_PC_NORMAL:20013,LIVE_AUTH_FAIL:20014},o={CLOSE_NORMAL:1e3,CLOSE_GOING_AWAY:1001,CLOSE_NO_STATUS:1005,CLOSE_ABNORMAL:1006,SVR_EXIT:4010,CLIENT_EXIT:4011,CLIENT_CONN_ERR:4021,CLIENT_RECONN_FAIL:4022};e.exports.CLI_ERR_CODE=r,e.exports.SVR_ERR_CODE=i,e.exports.WS_CLOSE_CODE=o},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(15),i=new r;e.exports=i},function(e,t,n){"use strict";var r={PULL_STREAM_REQ:1,PULL_STREAM_RSP:2,DEL_PULL_STREAM_REQ:3,DEL_PULL_STREAM_RSP:4,USER_EXIT_REQ:5,USER_EXIT_RSP:6,WS_RECONNECT_REQ:7,WS_RECONNECT_RSP:8,HEARTBEAT_REPORT_REQ:9,HEARTBEAT_REPORT_RSP:10,DOWN_PC_SDP_REQ:11,DOWN_PC_SDP_RSP:12,REPORT_BIZ_INFO_REQ:13,REPORT_CLIENT_INFO_REQ:15,REPORT_QUALITY:17,END_REPORT:19,CHECK_CATON:21,FIRST_FRAME_USETIME:23,ICE_STATE_REPORT:25,NOTIFY_USRE_ID_REQ:1001,NOTIFY_USER_TIMEOUT_REQ:101,NOTIFY_USER_TIMEOUT_RSP:102,NOTIFY_DEL_PEERC_REQ:103,NOTIFY_DEL_PEERC_RSP:104};e.exports.WS_CMD=r},function(e,t,n){"use strict";var r=n(19),i={TBS_MIN_VERSION:43600,h264Support:!1,checkTBSVersion:function(){for(var e=navigator.userAgent.split(" "),t=!1,n=0,r=0;r<e.length;r++){var i=e[r];if(-1!==i.indexOf("TBS")||-1!==i.indexOf("tbs")){t=!0;var o=i.split("/")[1];n=parseInt(o)||0}}return{isTBS:t,TBSversion:n,isTBSValid:n>=this.TBS_MIN_VERSION}},checkH264Support:function(e){if(window.RTCPeerConnection){var t=new RTCPeerConnection(null);t.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(function(n){e(-1===n.sdp.toLowerCase().indexOf("h264")?!1:!0),t.close()},function(t){e(!1)})}else e(!1)},support:function(e,t){"function"==typeof e?this.doCheck({screenshare:!1},e):this.doCheck(e,t)},doCheck:function(e,t){var n=!1;["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].forEach(function(e){n||e in window&&(n=!0)});var i=this.checkTBSVersion();if(!i.isTBS)if(this.isFF())n=!1;else if(this.isSafari()&&-1===navigator.platform.indexOf("Mac")){var o=this.iOSVersion();o&&(o[0]>=11&&o[1]>=1||o[0]>=12)||(n=!1)}var a={support:n,isTBS:i.isTBS,isTBSValid:i.isTBSValid,TBSversion:i.TBSversion,isSafari:this.isSafari(),iOSVersion:this.iOSVersion(),screenshare:!1,isFF:this.isFF(),userAgent:r.client};return n?(this.checkH264Support(function(n){if(a.h264Support=n,n||(a.support=!1),!e.screenshare&&t)return delete a.screenshare,void t(a);if(parseFloat(r.client.version)>=70&&"chrome"===r.client.type)return console.debug("[DetectRTC]: chrome 70 版本以后无需安装插件"),a.screenshare=!0,void t(a);var i=e.extensionId||null;ScreenChromeExtensionUtil.getChromeExtensionStatus(i,function(e){"installed-enabled"===e?ScreenChromeExtensionUtil.isChromeExtensionAvailable(function(e){e&&(a.screenshare=!0),t&&t(a)}):t&&t(a)})}),a):(a.h264Support=!1,void t(a))},isTBS:function(){return this.checkTBSVersion().isTBS},isSafari:function(){return navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&-1===navigator.userAgent.toLowerCase().indexOf("chrome/")},iOSVersion:function(){var e=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);return e&&[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]||0)]||!1},isFF:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("firefox")},isChrome:function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},detectMediaDevice:function(e){var t=!1,n=!1;navigator.mediaDevices.enumerateDevices().then(function(r){r.forEach(function(e){e&&"videoinput"===e.kind?n=!0:e&&"audioinput"===e.kind&&(t=!0)}),e&&e({hasAudio:t,hasVideo:n})}).catch(function(r){e&&e({hasAudio:t,hasVideo:n})})}};e.exports=i},function(e,t,n){n(11),e.exports=n(12)},function(e,t,n){"use strict";(function(n){var r,i,o,a,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){if("object"===s(t)&&void 0!==e)e.exports=n();else{i=[],r=n,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o)}}(function(){return function(){function e(t,n,r){function i(s,c){if(!n[s]){if(!t[s]){var d="function"==typeof a&&a;if(!c&&d)return a(s,!0);if(o)return o(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return i(t[s][1][e]||e)},u,u.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof a&&a,s=0;s<r.length;s++)i(r[s]);return i}return e}()({1:[function(e,t,n){},{}],2:[function(e,t,n){var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),d=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?r.parseFmtp(d[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var p=r.matchPrefix(e,"b=");return p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?1e3*parseInt(p[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=p})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i,o=void 0!==t?t:2;return i=e||r.generateSessionId(),"v=0\r\no="+(n||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"===(void 0===t?"undefined":s(t))&&(t.exports=r)},{}],3:[function(e,t,r){(function(n){var r=e("./adapter_factory.js");t.exports=r({window:n.window})}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,n){var r=e("./utils");t.exports=function(t,n){var i=t&&t.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in n)hasOwnProperty.call(n,a)&&(o[a]=n[a]);var s=r.log,c=r.detectBrowser(i),d=e("./chrome/chrome_shim")||null,p=e("./edge/edge_shim")||null,u=e("./firefox/firefox_shim")||null,l=e("./safari/safari_shim")||null,f=e("./common_shim")||null,m={browserDetails:c,commonShim:f,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),m;s("adapter.js shimming chrome."),m.browserShim=d,f.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),d.shimSenderReceiverGetStats(i),d.fixNegotiationNeeded(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"firefox":if(!u||!u.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),m;s("adapter.js shimming firefox."),m.browserShim=u,f.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimRemoveStream(i),u.shimSenderGetStats(i),u.shimReceiverGetStats(i),u.shimRTCDataChannel(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"edge":if(!p||!p.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),m;s("adapter.js shimming edge."),m.browserShim=p,f.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimPeerConnection(i),p.shimReplaceTrack(i),p.shimGetDisplayMedia(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"safari":if(!l||!o.shimSafari)return s("Safari shim is not included in this adapter release."),m;s("adapter.js shimming safari."),m.browserShim=l,f.shimCreateObjectURL(i),l.shimRTCIceServerUrls(i),l.shimCreateOfferLegacy(i),l.shimCallbacksAPI(i),l.shimLocalStreamsAPI(i),l.shimRemoteStreamsAPI(i),l.shimTrackEventTransceiver(i),l.shimGetUserMedia(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return m}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":1,"./firefox/firefox_shim":8,"./safari/safari_shim":10,"./utils":11}],5:[function(e,t,n){function r(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(i){i.endsWith("Id")?r(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(function(t){r(e,e.get(t),n)})}))}function i(e,t,n){var i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var a=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(function(t){e.forEach(function(n){n.type===i&&n.trackId===t.id&&r(e,n,o)})}),o}var o=e("../utils.js"),a=o.log;t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!==(void 0===e?"undefined":s(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)o.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this,o=n.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var t=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var n,r,i,o=arguments[0];return t.getSenders().forEach(function(e){e.track===o&&(n?i=!0:n=e)}),t.getReceivers().forEach(function(e){return e.track===o&&(r?i=!0:r=e),e.track===o}),i||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(t,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"===(void 0===e?"undefined":s(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=t.getSenders();n.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}if(e.RTCPeerConnection){var r=o.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}a.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var i=t(e,r);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=d.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=o.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,n){return a("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof arguments[0]))return n.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return n.apply(this,[c,arguments[0]])}return new Promise(function(e,t){n.apply(i,[function(t){e(s(a(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===s(arguments[0])){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){o.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){if(e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})},e.navigator.getDisplayMedia=function(t){return o.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)}}}}},{"../utils.js":11,"./getusermedia":6}],6:[function(e,t,n){var r=e("../utils.js"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!==(void 0===e?"undefined":s(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===s(e[n])?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=71)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===s(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===s(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":s(c))?c:{ideal:c});var d=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var p;if("environment"===c.exact||"environment"===c.ideal?p=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return p.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==p.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)})}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},c=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},d=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(c(e))})})};n.getUserMedia=d;var p=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:p,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}else n.mediaDevices.getUserMedia=function(e){return p(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":11}],7:[function(e,t,n){var r=e("sdp"),i=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":s(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=r.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===(void 0===e?"undefined":s(e))&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),o.delete(e)};var c=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return c.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,c.set.apply(this,[e])}});var d=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),d.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){var t=r.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=r.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!==n?-1:n},a=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},s=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=r.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;if(e._sctp=null,n(arguments[0])){var t,r=o(arguments[0]),i=a(r),d=s(arguments[0],r);t=0===i&&0===d?Number.POSITIVE_INFINITY:0===i||0===d?Math.max(i,d):Math.min(i,d);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return t}}),e._sctp=p}return c.apply(e,arguments)}}},shimSendThrowTypeError:function(e){function t(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=this,r=n.apply(e,arguments);return t(r,e),r},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}}}},{"./utils":11,sdp:2}],8:[function(e,t,n){var r=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!==(void 0===e?"undefined":s(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"===(void 0===e?"undefined":s(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===(void 0===e?"undefined":s(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"===(void 0===e?"undefined":s(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,r)}}},shimSenderGetStats:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n}),r.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){!e.navigator||!e.navigator.mediaDevices||"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)},e.navigator.getDisplayMedia=function(t){return r.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(t)})}}},{"../utils":11,"./getusermedia":9}],9:[function(e,t,n){var r=e("../utils"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,r,o){var c=function(e){if("object"!==(void 0===e?"undefined":s(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"===s(e[n])?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=c(e.audio)),e.video&&(e.video=c(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(a(e))})},d=function(e){return new Promise(function(t,n){c(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:d,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var p=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return p().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},f=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":s(e))&&"object"===s(e.audio)&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},o&&o.prototype.getSettings){var m=o.prototype.getSettings;o.prototype.getSettings=function(){var e=m.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var v=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":s(e))&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),v.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return c(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},{"../utils":11}],10:[function(e,t,n){var r=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}}},{"../utils":11}],11:[function(e,t,n){function r(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function i(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}var o=!0,a=!0;t.exports={extractVersion:r,wrapPeerConnectionEvent:i,disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":s(e))+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":s(e))+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===("undefined"==typeof window?"undefined":s(window))){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=r(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)n.browser="chrome",n.version=r(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=r(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=r(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}}},{}]},{},[3])(3)})}).call(t,n(6))},function(e,t,n){"use strict";function r(){var e=this,t=this.global={wsinited:!1,websocket:null,waitStreamUrls:new Set,peerConnections:{},localip:null,remoteip:null,signalip:null,sessionid:null,bizinfo:null,detectRTCResult:null,appId:0};this.rtcReport=new s(t),this.clearGlobal=function(){t.wsinited=!1,t.websocket=null,t.localip=null,t.remoteip=null,t.signalip=null,t.sessionid=null,t.waitStreamUrls=new Set;for(var e in t.peerConnections)l.emit("onRemoveStream",{streamId:e,streamUrl:t.peerConnections[e].streamUrl,code:m.RM_STREAM_USER_EXIT}),t.peerConnections[e].close(),delete t.peerConnections[e];t.peerConnections={}},this.clearWSState=function(){var e=this.global;e.wsinited=!1,e.websocket=null},this.onAddStream=function(t){a.debug("[onAddStream]e: ",t);var n=t.peerC,r=n.streamId;e.emit("onAddStream",{streamId:r,stream:t.stream})},this.onRemoveStream=function(t){e.rtcReport.removePlayerMonitor(t.streamUrl),e.emit("onRemoveStream",t)},this.onEvent=function(n){if(n.type==T.FIRST_FRAME_USETIME){var r={cmd:h.FIRST_FRAME_USETIME,content:n.content};e.wsSendMsg(r)}else if(n.type==T.CHECK_CATON){var i=n.content.streamUrl,o=d.getStreamId(i);if(!o)return void a.debug("[CHECK_CATON]streamUrl:"+i+", streamId is invalid!");var s=t.peerConnections[o];if(!s)return void a.debug("[CHECK_CATON]streamUrl:"+i+", streamId:"+o+", peerC not exist!");s.catonStat={startUTime:n.content.startTime,checkUtime:n.content.checkUtime,loadingDuration:n.content.loadingDuration,loadingTimes:n.content.loadingTimes}}else if(n.type==T.ICE_STATE_REPORT){var r={cmd:h.ICE_STATE_REPORT,content:n.content};e.wsSendMsg(r)}else e.emit("onEvent",n)},f.onAddStream=this.onAddStream,f.onRemoveStream=this.onRemoveStream,f.onEvent=this.onEvent;var n=d.query("env");if(n){var r=n+".rtc.qq.com";c.setHostname(r),c.setBkHostname(r)}var i=d.query("relayinnerip"),o=d.query("relayoutterip");i&&o&&(t.configRelayInnerIp=i,t.configRelayOutterIp=o)}var i=n(13),o=n(14),a=n(1),s=n(0).Report,c=n(2),d=n(3),p=n(18),u=n(20),l=n(4).emitter,f=n(4).emitterHandler,m=n(5).CLI_ERR_CODE,v=n(5).SVR_ERR_CODE,h=n(8).WS_CMD,g=n(9),C=n(0).reportSSO,y=n(0).SSO_REPORT_TYPE,S=n(0).SSO_ERR_CODE,T=c.EVENT;i.mixin(r),r.fn=r.prototype,r.fn.connectWS=function(e){var t=this.global;if(!t.websocket){var n=c.WS_URL,r=c.BK_WS_URL;t.websocket=this.initWebSocket(n,r)}},r.fn.setBizInfo=function(e){if(!e)return!1;var t=this.global;if(t.bizinfo=e,t.wsinited){var n={cmd:h.REPORT_BIZ_INFO_REQ,content:{bizinfo:e}};this.wsSendMsg(n),t.sessionid&&a.info("sessionId: "+t.sessionid+"bizInfo: "+JSON.stringify(t.bizinfo))}},r.fn.pullStream=function(e,t){var n=this.global,r=d.getStreamId(e);return a.debug("[pullStream]url: "+e+", streamId: "+r),r?(n.websocket||this.connectWS(),n.waitStreamUrls.has(e)||n.peerConnections[r]?void a.error("pull stream url："+e+", exist!"):(n.waitStreamUrls.add(e),n.wsinited&&this.sendStreamUrl(e),void(e&&t&&this.rtcReport.addPlayerMonitor(e,t)))):(a.warn("[pullStream]url: "+e+" invalid!"),void l.emit("onEvent",{type:T.STREAM_STATE,content:{code:m.STREAM_URL_INVALID,message:"pull stream url: "+e+" invalid!",streamId:r,streamUrl:e}}))},r.fn.stopStream=function(e){a.debug("[stopStream]url: "+e);var t=this.global,n=d.getStreamId(e);if(!n)return void l.emit("onEvent",{type:T.STREAM_STATE,content:{code:m.STREAM_URL_INVALID,message:"stop stream url: "+e+" invalid!",streamId:n,streamurl:e}});if(!t.peerConnections[n]&&!t.waitStreamUrls.has(e))return void a.debug("[stopStream]streamid: "+n+", not exist!");if(t.wsinited){var r={cmd:h.DEL_PULL_STREAM_REQ,content:{streamid:n}};this.wsSendMsg(r)}else t.waitStreamUrls.delete(e)&&a.info("[stopStream]streamUrl: "+e+", remove from waitStreamUrls!")},r.fn.userExit=function(){var e={cmd:h.USER_EXIT_REQ,content:{}};this.wsSendMsg(e)},r.fn.sendStreamUrl=function(e){a.info("[sendStreamUrl]streamUrl: "+e);var t={cmd:h.PULL_STREAM_REQ,content:{streamid:d.getStreamId(e),streamurl:e}};this.global.configRelayInnerIp&&(t.content.relayinnerip=this.global.configRelayInnerIp,t.content.relayoutterip=this.global.configRelayOutterIp),this.wsSendMsg(t)},r.fn.wsSendMsg=function(e){if(this.global.websocket)try{this.global.websocket.send(JSON.stringify(e))}catch(e){a.info("websocket send error, "+e.message)}},r.fn.initWebSocket=function(e,t,n){var r=this,i=this.global,s=function(e){a.debug("wsonopen",e),i.wsinited=!0,C({reportType:y.WS_OPEN,errorCode:S.SUCC});var t=!0,n=!1,o=void 0;try{for(var s,d=i.waitStreamUrls[Symbol.iterator]();!(t=(s=d.next()).done);t=!0){var p=s.value;r.sendStreamUrl(p)}}catch(e){n=!0,o=e}finally{try{!t&&d.return&&d.return()}finally{if(n)throw o}}if(i.detectRTCResult){var u={cmd:h.REPORT_CLIENT_INFO_REQ,content:{jsSdkVersion:c.Version,detectRTCResult:i.detectRTCResult}};r.wsSendMsg(u)}if(i.bizinfo){var u={cmd:h.REPORT_BIZ_INFO_REQ,content:{bizinfo:i.bizinfo}};r.wsSendMsg(u)}},f=function(e){a.info("wsonclose",e),l.emit("onEvent",{type:T.WS_STATE,content:{code:m.WS_CLOSE,message:"websocket colse!",extinfo:e}}),1==i.wsinited&&C({reportType:y.WS_CLOSE,errorCode:""+e.code,errorMsg:e.reason}),r.clearWSState()},g=function(e){a.info("wsonerror",e),l.emit("onEvent",{type:T.WS_STATE,content:{code:m.WS_ERROR,message:"websocket error!",extinfo:e}}),0==i.wsinited&&C({reportType:y.WS_OPEN,errorCode:S.FAILED}),r.clearWSState()},R=function(e){var t=e.data,n=JSON.parse(t),o=n.cmd,s=n.content;switch(o){case h.NOTIFY_USRE_ID_REQ:1==s.rc&&r.rebuildSession(),i.sessionid=s.sessionid,i.localip=s.clientip,i.signalip=s.signalip,i.remoteip=s.remoteip,a.info("[NOTIFY_USRE_ID_REQ]sessionid: "+s.sessionid+", JSSdkVersion:"+c.Version+", localip: "+s.clientip+", signalip: "+s.signalip+", remoteip: "+s.remoteip+"success!bizinfo: "+JSON.stringify(i.bizinfo)+", detectRTCResult:"+JSON.stringify(i.detectRTCResult)),l.emit("onEvent",{type:T.SESSION_ID,content:{sessionid:i.sessionid}});break;case h.PULL_STREAM_RSP:var u=s.streamid,f="",g=!0,C=!1,y=void 0;try{for(var S,R=i.waitStreamUrls[Symbol.iterator]();!(g=(S=R.next()).done);g=!0){var b=S.value;if(u==d.getStreamId(b)){f=b;break}}}catch(e){C=!0,y=e}finally{try{!g&&R.return&&R.return()}finally{if(C)throw y}}if(!f)return void a.info("[PULL_STREAM_RSP], streamId: "+u+", not in waitStreamUrls!");if(i.waitStreamUrls.delete(f)&&a.info("[PULL_STREAM_RSP] streamUrl: "+f+", remove from waitStreamUrls!"),s.errcode==v.SUCC){s.stunsvr&&(c.WEBRTC_STUN_SERVER=s.stunsvr);var E=i.peerConnections[u]=p.createPeerConnection(u);i.appId=s.appid,E.streamUrl=f,E.sessionInfo=s.peercinfo,a.debug("[PULL_STREAM_RSP]streamId:"+u+", "+JSON.stringify(E.sessionInfo)),r.onPeerConnection(u,s.sdp,s.candidate),a.debug("[PULL_STREAM_RSP], streamid: "+u+", success!")}else a.error("[PULL_STREAM_RSP], failed!, rsp: "+JSON.stringify(s)),r.rtcReport.removePlayerMonitor(f),l.emit("onEvent",{type:T.STREAM_STATE,content:{code:m.PULL_STREAM_FAIL,message:"pull stream url: "+f+" failed!errmsg:"+s.errmsg,streamId:u,streamurl:f}});break;case h.DEL_PULL_STREAM_RSP:a.debug("[DEL_PULL_STREAM_RSP], rsp: "+JSON.stringify(s));break;case h.USER_EXIT_RSP:a.debug("[USER_EXIT_RSP], rsp: "+JSON.stringify(s)),r.clearGlobal();break;case h.NOTIFY_DEL_PEERC_REQ:var _=s.exitcode,u=s.streamid,E=i.peerConnections[u],k=v.SUCC,w="";if(E){var f=E.streamUrl;E.close(),E=null,delete i.peerConnections[u],a.debug("[NOTIFY_DEL_PEERC]peerConnections: "+u+", exitCode: "+_),l.emit("onRemoveStream",{streamId:u,streamUrl:f,code:_}),k=v.SUCC,w="del peerc, streamId: "+u+" succ!"}else i.waitStreamUrls.delete(b)&&a.info("[NOTIFY_DEL_PEERC_REQ]streamUrl: "+b+", remove from waitStreamUrls!"),k=v.STREAM_NOT_EXIST,w="streamId: "+u+" not exist!",a.debug("NOTIFY_DEL_PEERC,exitCode: "+_+", errMsg: "+w);var e={cmd:h.NOTIFY_DEL_PEERC_RSP,content:{streamid:u,errcode:k,errmsg:w}};r.wsSendMsg(e)}};try{a.debug("begin init websocket");var b=e,E=t;n&&(b=b+"?"+o(n),E=E+"?"+o(n));var _=new u;return _.onmessage=R,_.onopen=s,_.onclose=f,_.onerror=g,_.open(b,E),_}catch(e){a.error("init web socket failed!!! exception: "+e.message)}},r.fn.onPeerConnection=function(e,t,n){var r=this,i=this.global,o=i.peerConnections[e];a.info("onPeerConnection streamid: "+e+", remotesdp:"+JSON.stringify(t)),o.setRemoteSdp(t).then(function(t){a.info(t),C({reportType:y.REMOTE_SDP,errorCode:S.SUCC}),o.getAnswerSdp(function(t,i){if(t==m.SUCC){a.info("getAnswerSdp callback!retcode: "+t+", msg:",i),C({reportType:y.LOCAL_SDP,errorCode:S.SUCC});var s={type:i.type,sdp:i.sdp},c={cmd:h.DOWN_PC_SDP_REQ,content:{streamid:e,localsdp:s}};r.wsSendMsg(c),o.onRemoteCandidate(n)}else l.emit("onEvent",{type:T.STREAM_STATE,content:{code:m.GET_LOCAL_SDP_FAIL,message:i,streamId:e,streamurl:o.streamUrl}}),C({reportType:y.LOCAL_SDP,errorCode:S.FAILED}),a.error("getAnswerSdp error, retcode: "+t+", errormsg: "+i)})}).catch(function(t){l.emit("onEvent",{type:T.STREAM_STATE,content:{code:m.SET_REMOTE_SDP_FAIL,message:t,streamId:e,streamurl:o.streamUrl}}),C({reportType:y.REMOTE_SDP,errorCode:S.FAILED}),a.error(t)})},r.fn.rebuildSession=function(){var e=this,t=this.global,n=[];for(var r in t.peerConnections){var i=t.peerConnections[r];i.sessionInfo&&n.push({streamid:r,streamurl:i.streamUrl,tinyid:i.sessionInfo.tinyid,srctinyid:i.sessionInfo.srctinyid,relayinnerip:i.sessionInfo.relayinnerip,relayoutterip:i.sessionInfo.relayoutterip})}var o={cmd:h.WS_RECONNECT_REQ,content:{appid:t.appId,oldsessionid:t.sessionid,oldlocalip:t.localip,oldremoteip:t.remoteip,oldsignal:t.signalip,peercs:n}};e.wsSendMsg(o)},r.fn.detectRTC=function(e){var t=this.global;return t.detectRTCResult?t.detectRTCResult:g.support(e)},window.TXWebRTCAPI=new r,window._tx_webrtc_enable?(a.info("default create websocket!_tx_webrtc_enable: "+window._tx_webrtc_enable),window.TXWebRTCAPI.connectWS()):a.info("not default create websocket!_tx_webrtc_enable: "+window._tx_webrtc_enable),window.TXWebRTCAPI.detectRTC(function(e){window.TXWebRTCAPI.global.detectRTCResult=e;var t=m.SUCC,n="Congratulations! This browser support webrtc!";if(e.support||(t=m.NOT_SUPPORT,n="So sad! This browser not support webrtc!"),a.info("[detectRTC]result: "+JSON.stringify(e)),l.emit("onEvent",{type:T.CLIENT_DETECT,content:{code:t,message:n,extinfo:e}}),window.TXWebRTCAPI.global.wsinited){var r={cmd:h.REPORT_CLIENT_INFO_REQ,content:{jsSdkVersion:c.Version,detectRTCResult:window.TXWebRTCAPI.global.detectRTCResult}};window.TXWebRTCAPI.wsSendMsg(r)}}),e.exports=r},function(e,t){function n(){}e.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){function r(){i.off(e,r),s.apply(this,arguments)}var i=this,o=3===arguments.length,a=o?arguments[1]:void 0,s=o?arguments[2]:arguments[1];return this.on(e,a,r),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var t,n,r,i;for(t in this.callbacks)for(i=this.callbacks[t],n=0,r=i.length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,r=this.callbacks[e];return r?1===arguments.length?(delete this.callbacks[e],this):(n=r.indexOf(t),-1!==n&&(r.splice(n,1),0===r.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,r,i=[].slice.call(arguments,1),o=this.callbacks[e],a=this.getWildcardCallbacks(e);if(o)for(r=o.slice(),t=0,n=r.length;t<n&&r[t];++t)r[t].apply(this,i);if(a)for(n=a.length,r=a.slice(),t=0,n=r.length;t<n&&r[t];++t)r[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},n.mixin(n)},function(e,t,n){var r,i;!function(n){"use strict";var o=function(e){var t=[],n=function(e,n){n="function"==typeof n?n():n,n=null===n?"":void 0===n?"":n,t[t.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)},r=function(e,i){var o,a,s;if(e)if(Array.isArray(i))for(o=0,a=i.length;o<a;o++)r(e+"["+("object"==typeof i[o]&&i[o]?o:"")+"]",i[o]);else if("[object Object]"===String(i))for(s in i)r(e+"["+s+"]",i[s]);else n(e,i);else if(Array.isArray(i))for(o=0,a=i.length;o<a;o++)n(i[o].name,i[o].value);else for(s in i)r(s,i[s]);return t};return r("",e).join("&")};"object"==typeof e&&"object"==typeof e.exports?e.exports=o:(r=[],void 0!==(i=function(){return o}.apply(t,r))&&(e.exports=i))}()},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={type:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},isObject:function(e,t){return t?"object"===this.type(e):e&&"object"===(void 0===e?"undefined":r(e))},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},encode:function(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")},formatParams:function(e){function t(e,o){var a=i.encode,s=i.type(e);if("array"==s)e.forEach(function(e,n){i.isObject(e)||(n=""),t(e,o+"%5B"+n+"%5D")});else if("object"==s)for(var c in e)o?t(e[c],o+"%5B"+a(c)+"%5D"):t(e[c],a(c));else r||(n+="&"),r=!1,n+=o+"="+a(e)}var n="",r=!0,i=this;return this.isObject(e)?(t(e,""),n):e},merge:function(e,t){for(var n in t)e.hasOwnProperty(n)?this.isObject(t[n],1)&&this.isObject(e[n],1)&&this.merge(e[n],t[n]):e[n]=t[n];return e}}},,function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),a="undefined"!=typeof document,s=function(){function e(t){function n(e){function t(){e.p=n=r=null}var n=void 0,r=void 0;o.merge(e,{lock:function(){n||(e.p=new Promise(function(e,t){n=e,r=t}))},unlock:function(){n&&(n(),t())},clear:function(){r&&(r("cancel"),t())}})}r(this,e),this.engine=t||XMLHttpRequest,this.default=this;var i=this.interceptors={response:{use:function(e,t){this.handler=e,this.onerror=t}},request:{use:function(e){this.handler=e}}},a=i.request;n(i.response),n(a),this.config={method:"GET",baseURL:"",headers:{},timeout:0,params:{},parseJson:!0,withCredentials:!1}}return i(e,[{key:"request",value:function(e,t,n){var r=this,i=new this.engine,s="Content-Type",c=s.toLowerCase(),d=this.interceptors,p=d.request,u=d.response,l=p.handler,f=new Promise(function(d,f){function m(e){return e&&e.then&&e.catch}function v(e,t){e?e.then(function(){t()}):t()}function h(n){function r(e,t,r){v(u.p,function(){if(e){r&&(t.request=n);var i=e.call(u,t,Promise);t=void 0===i?t:i}m(t)||(t=Promise[0===r?"resolve":"reject"](t)),t.then(function(e){d(e)}).catch(function(e){f(e)})})}function p(e){e.engine=i,r(u.onerror,e,-1)}function l(e,t){this.message=e,this.status=t}t=n.body,e=o.trim(n.url);var h=o.trim(n.baseURL||"");if(e||!a||h||(e=location.href),0!==e.indexOf("http")){var g="/"===e[0];if(!h&&a){var C=location.pathname.split("/");C.pop(),h=location.protocol+"//"+location.host+(g?"":C.join("/"))}if("/"!==h[h.length-1]&&(h+="/"),e=h+(g?e.substr(1):e),a){var y=document.createElement("a");y.href=e,e=y.href}}var S=o.trim(n.responseType||""),T=-1!==["GET","HEAD","DELETE","OPTION"].indexOf(n.method),R=o.type(t),b=n.params||{};T&&"object"===R&&(b=o.merge(t,b)),b=o.formatParams(b);var E=[];b&&E.push(b),T&&t&&"string"===R&&E.push(t),E.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+E.join("&")),i.open(n.method,e);try{i.withCredentials=!!n.withCredentials,i.timeout=n.timeout||0,"stream"!==S&&(i.responseType=S)}catch(e){}var _=n.headers[s]||n.headers[c],k="application/x-www-form-urlencoded";o.trim((_||"").toLowerCase())===k?t=o.formatParams(t):o.isFormData(t)||-1===["object","array"].indexOf(o.type(t))||(k="application/json;charset=utf-8",t=JSON.stringify(t)),_||T||(n.headers[s]=k);for(var w in n.headers)if(w===s&&o.isFormData(t))delete n.headers[w];else try{i.setRequestHeader(w,n.headers[w])}catch(e){}i.onload=function(){try{var e=i.response||i.responseText;e&&n.parseJson&&-1!==(i.getResponseHeader(s)||"").indexOf("json")&&!o.isObject(e)&&(e=JSON.parse(e));var t=i.responseHeaders;if(!t){t={};var a=(i.getAllResponseHeaders()||"").split("\r\n");a.pop(),a.forEach(function(e){if(e){var n=e.split(":")[0];t[n]=i.getResponseHeader(n)}})}var c=i.status,d=i.statusText,f={data:e,headers:t,status:c,statusText:d};if(o.merge(f,i._response),c>=200&&c<300||304===c)f.engine=i,f.request=n,r(u.handler,f,0);else{var m=new l(d,c);m.response=f,p(m)}}catch(m){p(new l(m.msg,i.status))}},i.onerror=function(e){p(new l(e.msg||"Network Error",0))},i.ontimeout=function(){p(new l("timeout [ "+i.timeout+"ms ]",1))},i._options=n,setTimeout(function(){i.send(T?null:t)},0)}o.isObject(e)&&(n=e,e=n.url),n=n||{},n.headers=n.headers||{},v(p.p,function(){o.merge(n,JSON.parse(JSON.stringify(r.config)));var i=n.headers;i[s]=i[s]||i[c]||"",delete i[c],n.body=t||n.body,e=o.trim(e||""),n.method=n.method.toUpperCase(),n.url=e;var a=n;l&&(a=l.call(p,n,Promise)||n),m(a)||(a=Promise.resolve(a)),a.then(function(e){e===n?h(e):d(e)},function(e){f(e)})})});return f.engine=i,f}},{key:"all",value:function(e){return Promise.all(e)}},{key:"spread",value:function(e){return function(t){return e.apply(null,t)}}}]),e}();s.default=s,["get","post","put","patch","head","delete"].forEach(function(e){s.prototype[e]=function(t,n,r){return this.request(t,n,o.merge({method:e},r))}}),["lock","unlock","clear"].forEach(function(e){s.prototype[e]=function(){this.interceptors.request[e]()}}),e.exports=s}])})},function(e,t,n){"use strict";(function(n){var r,i,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,r){function i(){a(function(e){if(e&&e.forEach){e.forEach(function(e){Object.keys(p).forEach(function(t){if("function"==typeof p[t])try{p[t](e)}catch(e){console.error(e.message,e.stack,e)}})});try{-1!==l.iceConnectionState.search(/failed|closed|disconnected/gi)&&(f=!0)}catch(e){f=!0}!0===f&&(d.datachannel&&(d.datachannel.state="close"),d.ended=!0),d.results=e,d.audio&&d.video&&(d.bandwidth.speed=d.audio.bytesSent-d.bandwidth.helper.audioBytesSent+(d.video.bytesSent-d.bandwidth.helper.videoBytesSent),d.bandwidth.helper.audioBytesSent=d.audio.bytesSent,d.bandwidth.helper.videoBytesSent=d.video.bytesSent),t(d),f||void 0!=(void 0===r?"undefined":o(r))&&r&&setTimeout(i,r||1e3)}})}function a(e){void 0!==window.InstallTrigger||u?l.getStats(window.mediaStreamTrack||null).then(function(t){var n=[];t.forEach(function(e){n.push(e)}),e(n)}).catch(e):l.getStats(function(t){var n=[];t.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),e(n)})}!function(e){e&&"undefined"==typeof window&&void 0!==n&&(n.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},n.console||(n.console={}),void 0!==n.console.log&&void 0!==n.console.error||(n.console.error=n.console.log=n.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),"undefined"==typeof URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),"undefined"==typeof MediaStreamTrack&&(e.MediaStreamTrack=function(){}),void 0===s&&(e.RTCPeerConnection=function(){}),e.window=n)}(void 0!==n?n:null);var s=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var c=((navigator.connection||{}).type||"unknown").toString().toLowerCase(),d={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:c,systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){f=!0}},p={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(d.isOfferer=e.googInitiator)}},u=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),l=this;if(!(arguments[0]instanceof s))throw"1st argument is not instance of RTCPeerConnection.";l=arguments[0],arguments[1]instanceof MediaStreamTrack&&(arguments[1],t=arguments[2],r=arguments[3]);var f=!1;p.datachannel=function(e){"datachannel"===e.type&&(d.datachannel={state:e.state})},p.googCertificate=function(e){"googCertificate"==e.type&&(d.encryption=e.googFingerprintAlgorithm),"certificate"==e.type&&(d.encryption=e.fingerprintAlgorithm)},p.checkAudioTracks=function(e){if("audio"===e.mediaType){var t=e.id.split("_").pop();if(!0===e.isRemote&&(t="recv"),!1===e.isRemote&&(t="send"),t){if(-1===d.audio[t].codecs.indexOf(e.googCodecName||"opus")&&d.audio[t].codecs.push(e.googCodecName||"opus"),e.bytesSent){var n=0;d.internal.audio[t].prevBytesSent||(d.internal.audio[t].prevBytesSent=e.bytesSent);var r=e.bytesSent-d.internal.audio[t].prevBytesSent;d.internal.audio[t].prevBytesSent=e.bytesSent,n=r/1024,d.audio[t].availableBandwidth=n.toFixed(1),d.audio.bytesSent=n.toFixed(1)}if(e.bytesReceived){var n=0;d.internal.audio[t].prevBytesReceived||(d.internal.audio[t].prevBytesReceived=e.bytesReceived);var r=e.bytesReceived-d.internal.audio[t].prevBytesReceived;d.internal.audio[t].prevBytesReceived=e.bytesReceived,n=r/1024,d.audio.bytesReceived=n.toFixed(1)}if(e.googTrackId&&-1===d.audio[t].tracks.indexOf(e.googTrackId)&&d.audio[t].tracks.push(e.googTrackId),e.googCurrentDelayMs){var n=0;d.internal.audio.prevGoogCurrentDelayMs||(d.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs);var r=e.googCurrentDelayMs-d.internal.audio.prevGoogCurrentDelayMs;d.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs,d.audio.latency=r.toFixed(1),d.audio.latency<0&&(d.audio.latency=0)}if(e.packetsLost){var n=0;d.internal.audio.prevPacketsLost||(d.internal.audio.prevPacketsLost=e.packetsLost);var r=e.packetsLost-d.internal.audio.prevPacketsLost;d.internal.audio.prevPacketsLost=e.packetsLost,d.audio.packetsLost=r.toFixed(1),d.audio.packetsLost<0&&(d.audio.packetsLost=0)}}}},p.checkVideoTracks=function(e){if("video"===e.mediaType){var t=e.id.split("_").pop();if(!0===e.isRemote&&(t="recv"),!1===e.isRemote&&(t="send"),t){if(-1===d.video[t].codecs.indexOf(e.googCodecName||"VP8")&&d.video[t].codecs.push(e.googCodecName||"VP8"),e.bytesSent){var n=0;d.internal.video[t].prevBytesSent||(d.internal.video[t].prevBytesSent=e.bytesSent);var r=e.bytesSent-d.internal.video[t].prevBytesSent;d.internal.video[t].prevBytesSent=e.bytesSent,n=r/1024,d.video[t].availableBandwidth=n.toFixed(1),d.video.bytesSent=n.toFixed(1)}if(e.bytesReceived){var n=0;d.internal.video[t].prevBytesReceived||(d.internal.video[t].prevBytesReceived=e.bytesReceived);var r=e.bytesReceived-d.internal.video[t].prevBytesReceived;d.internal.video[t].prevBytesReceived=e.bytesReceived,n=r/1024,d.video.bytesReceived=n.toFixed(1)}if(e.googFrameHeightReceived&&e.googFrameWidthReceived&&(d.resolutions[t].width=e.googFrameWidthReceived,d.resolutions[t].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(d.resolutions[t].width=e.googFrameWidthSent,d.resolutions[t].height=e.googFrameHeightSent),e.googTrackId&&-1===d.video[t].tracks.indexOf(e.googTrackId)&&d.video[t].tracks.push(e.googTrackId),e.framerateMean){d.bandwidth.framerateMean=e.framerateMean;var n=0;d.internal.video[t].prevFramerateMean||(d.internal.video[t].prevFramerateMean=e.bitrateMean);var r=e.bytesSent-d.internal.video[t].prevFramerateMean;d.internal.video[t].prevFramerateMean=e.framerateMean,n=r/1024,d.video[t].framerateMean=r.toFixed(1)}if(e.bitrateMean){d.bandwidth.bitrateMean=e.bitrateMean;var n=0;d.internal.video[t].prevBitrateMean||(d.internal.video[t].prevBitrateMean=e.bitrateMean);var r=e.bytesSent-d.internal.video[t].prevBitrateMean;d.internal.video[t].prevBitrateMean=e.bitrateMean,n=r/1024,d.video[t].bitrateMean=r.toFixed(1)}if(e.googCurrentDelayMs){var n=0;d.internal.video.prevGoogCurrentDelayMs||(d.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs);var r=e.googCurrentDelayMs-d.internal.video.prevGoogCurrentDelayMs;d.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs,d.video.latency=r.toFixed(1),d.video.latency<0&&(d.video.latency=0)}if(e.packetsLost){var n=0;d.internal.video.prevPacketsLost||(d.internal.video.prevPacketsLost=e.packetsLost);var r=e.packetsLost-d.internal.video.prevPacketsLost;d.internal.video.prevPacketsLost=e.packetsLost,d.video.packetsLost=r.toFixed(1),d.video.packetsLost<0&&(d.video.packetsLost=0)}}}},p.bweforvideo=function(e){"VideoBwe"===e.type&&(d.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,d.bandwidth.googActualEncBitrate=e.googActualEncBitrate,d.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,d.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,d.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,d.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,d.bandwidth.googBucketDelay=e.googBucketDelay,d.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},p.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type||"local-candidate"===e.type||"remote-candidate"===e.type){if("true"==e.googActiveConnection){Object.keys(d.internal.candidates).forEach(function(t){var n=d.internal.candidates[t];-1!==n.ipAddress.indexOf(e.googLocalAddress)&&(d.connectionType.local.candidateType=n.candidateType,d.connectionType.local.ipAddress=n.ipAddress,d.connectionType.local.networkType=n.networkType,d.connectionType.local.transport=n.transport),-1!==n.ipAddress.indexOf(e.googRemoteAddress)&&(d.connectionType.remote.candidateType=n.candidateType,d.connectionType.remote.ipAddress=n.ipAddress,d.connectionType.remote.networkType=n.networkType,d.connectionType.remote.transport=n.transport)}),d.connectionType.transport=e.googTransportType;var t=d.internal.candidates[e.localCandidateId];t&&t.ipAddress&&(d.connectionType.systemIpAddress=t.ipAddress);var n=d.internal.candidates[e.remoteCandidateId];n&&n.ipAddress&&(d.connectionType.systemIpAddress=n.ipAddress)}if("candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=d.internal.candidates[e.remoteCandidateId],n=d.internal.candidates[e.remoteCandidateId];if("local-candidate"===e.type&&(d.connectionType.local.candidateType=e.candidateType,d.connectionType.local.ipAddress=e.ipAddress,d.connectionType.local.networkType=e.networkType,d.connectionType.local.transport=e.mozLocalTransport||e.transport),"remote-candidate"===e.type&&(d.connectionType.remote.candidateType=e.candidateType,d.connectionType.remote.ipAddress=e.ipAddress,d.connectionType.remote.networkType=e.networkType,d.connectionType.remote.transport=e.mozRemoteTransport||e.transport),u){var r=e.localCandidateId?"send":"recv";if(!r)return;if(e.bytesSent){var i=0;d.internal.video[r].prevBytesSent||(d.internal.video[r].prevBytesSent=e.bytesSent);var o=e.bytesSent-d.internal.video[r].prevBytesSent;d.internal.video[r].prevBytesSent=e.bytesSent,i=o/1024,d.video[r].availableBandwidth=i.toFixed(1),d.video.bytesSent=i.toFixed(1)}if(e.bytesReceived){var i=0;d.internal.video[r].prevBytesReceived||(d.internal.video[r].prevBytesReceived=e.bytesReceived);var o=e.bytesReceived-d.internal.video[r].prevBytesReceived;d.internal.video[r].prevBytesReceived=e.bytesReceived,i=o/1024,d.video.bytesReceived=i.toFixed(1)}if(e.availableOutgoingBitrate){var i=0;d.internal.video[r].prevAvailableOutgoingBitrate||(d.internal.video[r].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate);var o=e.availableOutgoingBitrate-d.internal.video[r].prevAvailableOutgoingBitrate;d.internal.video[r].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate,i=o/1024,d.video.availableOutgoingBitrate=i.toFixed(1)}if(e.availableIncomingBitrate){var i=0;d.internal.video[r].prevAvailableIncomingBitrate||(d.internal.video[r].prevAvailableIncomingBitrate=e.availableIncomingBitrate);var o=e.availableIncomingBitrate-d.internal.video[r].prevAvailableIncomingBitrate;d.internal.video[r].prevAvailableIncomingBitrate=e.availableIncomingBitrate,i=o/1024,d.video.availableIncomingBitrate=i.toFixed(1)}}}};var m={},v={},h={},g={};p.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(m[e.id]||(m[e.id]=[]),v[e.id]||(v[e.id]=[]),h[e.id]||(h[e.id]=[]),g[e.id]||(g[e.id]=[]),e.candidateType&&-1===m[e.id].indexOf(e.candidateType)&&m[e.id].push(e.candidateType),e.transport&&-1===v[e.id].indexOf(e.transport)&&v[e.id].push(e.transport),e.ipAddress&&-1===h[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&h[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===g[e.id].indexOf(e.networkType)&&g[e.id].push(e.networkType),d.internal.candidates[e.id]={candidateType:m[e.id],ipAddress:h[e.id],portNumber:e.portNumber,networkType:g[e.id],priority:e.priority,transport:v[e.id],timestamp:e.timestamp,id:e.id,type:e.type},d.connectionType.local.candidateType=m[e.id],d.connectionType.local.ipAddress=h[e.id],d.connectionType.local.networkType=g[e.id],d.connectionType.local.transport=v[e.id])};var C={},y={},S={},T={};p.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(C[e.id]||(C[e.id]=[]),y[e.id]||(y[e.id]=[]),S[e.id]||(S[e.id]=[]),T[e.id]||(T[e.id]=[]),e.candidateType&&-1===C[e.id].indexOf(e.candidateType)&&C[e.id].push(e.candidateType),e.transport&&-1===y[e.id].indexOf(e.transport)&&y[e.id].push(e.transport),e.ipAddress&&-1===S[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&S[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===T[e.id].indexOf(e.networkType)&&T[e.id].push(e.networkType),d.internal.candidates[e.id]={candidateType:C[e.id],ipAddress:S[e.id],portNumber:e.portNumber,networkType:T[e.id],priority:e.priority,transport:y[e.id],timestamp:e.timestamp,id:e.id,type:e.type},d.connectionType.remote.candidateType=C[e.id],d.connectionType.remote.ipAddress=S[e.id],d.connectionType.remote.networkType=T[e.id],d.connectionType.remote.transport=y[e.id])},p.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(d[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(d[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},p.inboundrtp=function(e){if(u&&"inbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var r=0;d.internal[t][n].prevBytesSent||(d.internal[t][n].prevBytesSent=e.bytesSent);var i=e.bytesSent-d.internal[t][n].prevBytesSent;d.internal[t][n].prevBytesSent=e.bytesSent,r=i/1024,d[t][n].availableBandwidth=r.toFixed(1),d[t].bytesSent=r.toFixed(1)}if(e.bytesReceived){var r=0;d.internal[t][n].prevBytesReceived||(d.internal[t][n].prevBytesReceived=e.bytesReceived);var i=e.bytesReceived-d.internal[t][n].prevBytesReceived;d.internal[t][n].prevBytesReceived=e.bytesReceived,r=i/1024,d[t].bytesReceived=r.toFixed(1)}}}},p.outboundrtp=function(e){if(u&&"outbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var r=0;d.internal[t][n].prevBytesSent||(d.internal[t][n].prevBytesSent=e.bytesSent);var i=e.bytesSent-d.internal[t][n].prevBytesSent;d.internal[t][n].prevBytesSent=e.bytesSent,r=i/1024,d[t][n].availableBandwidth=r.toFixed(1),d[t].bytesSent=r.toFixed(1)}if(e.bytesReceived){var r=0;d.internal[t][n].prevBytesReceived||(d.internal[t][n].prevBytesReceived=e.bytesReceived);var i=e.bytesReceived-d.internal[t][n].prevBytesReceived;d.internal[t][n].prevBytesReceived=e.bytesReceived,r=i/1024,d[t].bytesReceived=r.toFixed(1)}}}},p.track=function(e){if(u&&"track"===e.type){var t=!0===e.remoteSource?"send":"recv";e.frameWidth&&e.frameHeight&&(d.resolutions[t].width=e.frameWidth,d.resolutions[t].height=e.frameHeight)}};var R={audio:{send:[],recv:[]},video:{send:[],recv:[]}};p.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===R[e.mediaType][t].indexOf(e.ssrc)&&R[e.mediaType][t].push(e.ssrc),d[e.mediaType][t].streams=R[e.mediaType][t].length}},i()};e.exports=a,r=[],void 0!==(i=function(){return a}.apply(t,r))&&(e.exports=i)}).call(t,n(6))},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){function e(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}}return e})},function(e,t,n){"use strict";var r=n(4).emitter,i=n(1),o=n(2),a=n(3),s=(n(9),n(5).CLI_ERR_CODE),c=n(0).reportSSO,d=n(0).SSO_REPORT_TYPE,p=n(0).SSO_ICE_STAT,u=o.EVENT,l=function(e){var t=!1;try{for(var n=e.split("\r\n"),r=0;r<n.length;r++){var o=n[r];if(-1!==o.indexOf("a=rtpmap")&&(-1!==o.indexOf("H264/")||-1!==o.indexOf("h264/"))){t=!0;break}}}catch(e){i.error(e)}return t},f=function(e){try{return e.candidate.split(" ")[7]}catch(e){return null}},m=function(e){try{return e.candidate.split(" ")[2]}catch(e){return null}},v=function(e){try{return e.candidate.split(" ")[4]}catch(e){return null}},h=function(e){if(0===e.length)return!1;var t=null,n=null;return e.forEach(function(e){var r=v(e);"udp"===f(e)&&("srflx"===m(e)?t={sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}:"host"!==m(e)||a.isInnerIPFn(r)||(n={sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}))}),t||n||null};window.RTCPeerConnection?(RTCPeerConnection.fn=RTCPeerConnection.prototype,RTCPeerConnection.fn.getAnswerSdp=function(e){var t=this;t.createAnswer(o.SDP_OPTION).then(function(n){if(l(n.sdp))return n.type="answer",t.setLocalDescription(n);var r="pc[streamId: "+t.streamId+"], this browser is not SupportH264!";i.debug(r,n),e(s.GET_LOCALSDP_FAILED,"this web browser do not support h264!")}).then(function(n){var r=t.localDescription;i.debug("pc[streamId: "+t.streamId+"] setLocalDescription succ!"),e(s.SUCC,r)}).catch(function(t){i.error("create answer failed : reason = "+t,t),e(s.GET_LOCALSDP_FAILED,t)})},RTCPeerConnection.fn.setRemoteSdp=function(e){var t=this;return new Promise(function(n,r){t.setRemoteDescription(new RTCSessionDescription(e),function(){var e="setRemoteSdp succ!streamId: "+t.streamId;i.info(e),n(e)},function(e){var n="setRemoteSdp failed, streamId: "+t.streamId+", exception = "+e.message;i.error(n),r(n)})})},RTCPeerConnection.fn.onIceCandidate=function(e){var t=this,n=e.candidate;if(!n)return i.debug("[onIceCandidate]Ice Candidate End!"),void(t.iceCandidateEnd=!0);if(i.debug("[onIceCandidate]: "+JSON.stringify(n)),n&&n.candidate){t.localCandidateList.push(n);var n=h(t.localCandidateList)}},RTCPeerConnection.fn.onRemoteCandidate=function(e){i.debug("onRemoteCandidate",this),this.addIceCandidate(e,function(t){i.debug("add ice candidate ok!"+JSON.stringify(e))},function(t){i.error("add ice candidate error!"+JSON.stringify(e))})},RTCPeerConnection.fn.startGetStats=function(){function e(e){if(i.debug("getStats, stats:",a.cloneObj(e)),i.debug("getStats, results:",e.results),"closed"===n.iceConnectionState||"closed"===n.signalingState)return e.nomore(),void(n.stats&&(n.stats=null));n.stats=e}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.REPORT_QUALITY_INTERVAL_TIME,n=this;getstats(n,e,t)}):i.error("Not support webrtc!");var g={createPeerConnection:function(e){i.debug("createPeerConnection, streamId: "+e);var t=o.getPeerCConfig(),n=o.PEERC_OPTIONAL,a=new RTCPeerConnection(t,n);return a.localCandidateList=[],a.streamId=e,a.streamUrl=null,a.sessionInfo=null,a.createUtime=(new Date).getTime(),a.onicecandidate=function(e){a.onIceCandidate(e)},a.onaddstream=function(e){e.peerC=a,"plan-b"==t.sdpSemantics&&(i.info("peerConnection[streamId: "+a.streamId+",].onaddstream"),r.emit("onAddStream",e))},a.onremovestream=function(e){i.info("peerConnection[streamId: "+a.streamId+"].onremovestream"),"plan-b"==t.sdpSemantics&&(i.info("peerConnection[streamId: "+a.streamId+"].onremovestream"),r.emit("onRemoveStream",{streamId:a.streamId,streamUrl:a.streamUrl,code:s.RM_STREAM_PCEVENT}))},a.ontrack=function(e){if(e.peerC=a,i.info("peerConnection[streamId: "+a.streamId+"] ontrack, kind:"+e.track.kind+",track.id:"+e.track.id),"unified-plan"==t.sdpSemantics){var n=e.track;a.stream?(a.stream.addTrack(n),i.info("track.lenght:"+a.stream.getTracks().length)):(a.stream=new MediaStream,a.stream.addTrack(n),e.peerC=a,e.stream=a.stream,r.emit("onAddStream",e)),n.onmute=function(e){i.info("peerConnection[streamId: "+a.streamId+"] track onmute, track.kind:"+n.kind+", track.id:"+n.id)},n.onended=function(e){i.info("peerConnection[streamId: "+a.streamId+"] track onended, track.kind:"+n.kind+", track.id:"+n.id)}}},a.onconnectionstatechange=function(e){i.debug("onconnectionstatechange",e)},a.oniceconnectionstatechange=function(e){if(e.peerC=a,i.debug("peerConnection[streamId: "+a.streamId+"].oniceconnectionstatechange : iceConnectionState = "+e.target.iceConnectionState+", iceGatheringState = "+e.target.iceGatheringState),r.emit("onEvent",{type:u.ICE_STATE_REPORT,content:{streamUrl:a.streamUrl,iceConnectionState:e.target.iceConnectionState,iceGatheringState:e.target.iceGatheringState}}),this.isComplete=!1,console.log("oniceconnectionstatechange",e.target,e.target.iceConnectionState,e.target.iceGatheringState),"completed"===e.target.iceConnectionState&&"complete"===e.target.iceGatheringState)console.log("ice完成0"),r.emit("onEvent",{type:u.ICE_STATE,content:{code:s.ICE_COMPLETE,streamId:a.streamId,message:"ice complete!",extinfo:e}}),c({reportType:d.ICE_CONN,errorCode:p.COMPLETE,errorMsg:"iceConnectionState="+e.target.iceConnectionState+",iceGatheringState="+e.target.iceGatheringState+"!"});else if("connected"===e.target.iceConnectionState&&"complete"===e.target.iceGatheringState)console.log("ice完成1"),r.emit("onEvent",{type:u.ICE_STATE,content:{code:s.ICE_COMPLETE,streamId:a.streamId,message:"ice complete!",extinfo:e}}),c({reportType:d.ICE_CONN,errorCode:p.COMPLETE,errorMsg:"iceConnectionState="+e.target.iceConnectionState+",iceGatheringState="+e.target.iceGatheringState+"!"});else if("connected"===e.target.iceConnectionState){if(a.getConfiguration){var t=a.getConfiguration();"unified-plan"===t.sdpSemantics&&(console.log("ice完成2"),r.emit("onEvent",{type:u.ICE_STATE,content:{code:s.ICE_COMPLETE,streamId:a.streamId,message:"ice complete!",extinfo:e}}))}c({reportType:d.ICE_CONN,errorCode:p.COMPLETE,errorMsg:"iceConnectionState="+e.target.iceConnectionState+",iceGatheringState="+e.target.iceGatheringState+"!"})}else"disconnected"===e.target.iceConnectionState||"disconnected"===e.target.iceGatheringState?c({reportType:d.ICE_CONN,errorCode:p.DISCONN,errorMsg:"iceConnectionState="+e.target.iceConnectionState+",iceGatheringState="+e.target.iceGatheringState+"!"}):"failed"===e.target.iceConnectionState||"failed"===e.target.iceGatheringState?(r.emit("onEvent",{type:u.ICE_STATE,content:{code:s.ICE_DISCONN,streamId:a.streamId,message:"iceConnectionState: "+e.target.iceConnectionState+", iceGatheringState: "+e.target.iceGatheringState,extinfo:e}}),c({reportType:d.ICE_CONN,errorCode:p.FAILED,errorMsg:"iceConnectionState="+e.target.iceConnectionState+",iceGatheringState="+e.target.iceGatheringState+"!"}),i.error("peerConnection[streamId: "+a.streamId+"].oniceconnectionstatechange : iceConnectionState = "+e.target.iceConnectionState+", iceGatheringState = "+e.target.iceGatheringState)):"closed"!==e.target.iceConnectionState&&"closed"!==e.target.iceGatheringState||(r.emit("onEvent",{type:u.ICE_STATE,content:{code:s.ICE_CLOSE,streamId:a.streamId,message:"iceConnectionState: "+e.target.iceConnectionState+", iceGatheringState: "+e.target.iceGatheringState,extinfo:e}}),c({reportType:d.ICE_CONN,errorCode:p.CLOSE,errorMsg:"iceConnectionState="+e.target.iceConnectionState+",iceGatheringState="+e.target.iceGatheringState+"!"}),i.info("peerConnection[streamId: "+a.streamId+"].oniceconnectionstatechange : iceConnectionState = "+e.target.iceConnectionState+", iceGatheringState = "+e.target.iceGatheringState))},a.onicegatheringstatechange=function(e){},a.onsignalingstatechange=function(e){},a.onnegotiationneeded=function(e){i.debug("peerConnection[streamId: "+a.streamId+"].onnegotiationneeded",e)},a}};e.exports=g},function(e,t,n){"use strict";var r=window.document,i=window.navigator,o=i.userAgent.toLowerCase(),a=r.documentMode,s=window.chrome||!1,c={agent:o,isIE:/msie/.test(o),isIPhone:/iphone/.test(o),isGecko:o.indexOf("gecko")>0&&o.indexOf("like gecko")<0,isWebkit:o.indexOf("webkit")>0,isStrict:"CSS1Compat"===r.compatMode,supportSubTitle:function(){return"track"in r.createElement("track")},supportScope:function(){return"scoped"in r.createElement("style")},ieVersion:function(){try{return o.match(/msie ([\d.]+)/)[1]||0}catch(e){return a}},operaVersion:function(){try{if(window.opera)return o.match(/opera.([\d.]+)/)[1];if(o.indexOf("opr")>0)return o.match(/opr\/([\d.]+)/)[1]}catch(e){return 0}},versionFilter:function(){if(1===arguments.length&&"string"==typeof arguments[0]){var e=arguments[0];return start=e.indexOf("."),start>0&&(end=e.indexOf(".",start+1),-1!==end)?e.substr(0,end):e}return 1===arguments.length?arguments[0]:0}};try{c.type=c.isIE?"ie":window.opera||o.indexOf("opr")>0?"opera":o.indexOf("chrome")>0?"chrome":window.openDatabase?"safari":o.indexOf("firefox")>0?"firefox":"unknow",c.version="ie"===c.type?c.ieVersion():"firefox"===c.type?o.match(/firefox\/([\d.]+)/)[1]:"chrome"===c.type?o.match(/chrome\/([\d.]+)/)[1]:"opera"===c.type?c.operaVersion():"safari"===c.type?o.match(/version\/([\d.]+)/)[1]:"0",c.shell=function(){if(o.indexOf("maxthon")>0)return c.version=o.match(/maxthon\/([\d.]+)/)[1]||c.version,"maxthon";if(o.indexOf("qqbrowser")>0)return c.version=o.match(/qqbrowser\/([\d.]+)/)[1]||c.version,"qqbrowser";if(o.indexOf("se 2.x")>0)return"sougou";if(s&&"opera"!==c.type){var e=window.external,t=window.clientInformation,n=t.languages;if(e&&"LiebaoGetVersion"in e)return"liebao";if(o.indexOf("bidubrowser")>0)return c.version=o.match(/bidubrowser\/([\d.]+)/)[1]||o.match(/chrome\/([\d.]+)/)[1],"baidu";if(c.supportSubTitle()&&void 0===n){var r=Object.keys(s.webstore).length;window;return r>1?"360qucik":"360secure"}return"chrome"}return c.type},c.name=c.shell(),c.version=c.versionFilter(c.version)}catch(e){}e.exports={client:c}},function(module,exports,__webpack_require__){"use strict";function WebSocketClient(){this.instance=null,this.instancebk=null,this.retryCount=Constants.WS_MAX_RETRY_COUNT,this.url=null,this.bkurl=null,this.hasConnect=!1,this.usebkurl=!1,this.isbkurl=!1,this.trybkTimer=null,this.relayInfo={innerip:null,outterip:null,dataport:0,stunport:0},this.sessioninfo={openid:null,tinyid:null,srcids:[],sessionid:0,peersdp:{}},this.reconnectTimer=null}var RTCLog=__webpack_require__(1),Constants=__webpack_require__(2),WS_CLOSE_CODE=__webpack_require__(5).WS_CLOSE_CODE;WebSocketClient.prototype.trybkurl=function(){var e=this;return this.usebkurl?void RTCLog.debug("[WebSocketClient]trybkurl, bk url: "+this.bkurl+", has used!"):this.bkurl?(RTCLog.debug("[WebSocketClient]trybkurl, use bk url: "+this.bkurl),this.usebkurl=!0,this.instancebk=new WebSocket(this.bkurl),this.instancebk.onopen=function(){var t=e;if(t.hasConnect)return void RTCLog.error("[WebSocketClient]bk websocket open, open more than one!!");t.hasConnect=!0,RTCLog.debug("[WebSocketClient]bk websocket wsopen"),null!=t.instance&&(t.instance.close(),t.instance=null),t.isbkurl=!0,t.instance=t.instancebk,t.instancebk=null,t.instance.onerror=function(t){RTCLog.error("[WebSocketClient]websocket wsonerror ",t),e.onerror(t)},t.instance.onclose=function(t){switch(RTCLog.error("[WebSocketClient]websocket wsonclose ",t),t.code){case WS_CLOSE_CODE.CLOSE_NORMAL:e.onclose(t);break;default:e.retryCount<=0?e.onclose(t):e.reconnect(t)}},t.retryCount=Constants.WS_MAX_RETRY_COUNT,RTCLog.debug("[WebSocketClient]web socket connect success",t),t.onopen()},this.instancebk.onerror=function(t){RTCLog.error("[WebSocketClient]bk websocket init error");var n=e;n.hasConnect||(n.instancebk.close(4021),n.instancebk=null,null==n.instance&&null==n.instancebk&&(RTCLog.error("[WebSocketClient]main and bk url connect failed",t),n.retryCount<=0?n.onerror(t):n.reconnect(t)))},this.instancebk.onclose=function(e){RTCLog.error("[WebSocketClient]bk websocket init close",e)},void(this.instancebk.onmessage=function(t){e.onmessage(t)})):void RTCLog.debug("[WebSocketClient]trybkurl, bk url is null!")},WebSocketClient.prototype.open=function(e,t){RTCLog.debug("[WebSocketClient]begin connection websocket server, url = "+e+", bkurl = "+t);var n=this;if(this.url=e,this.bkurl=t,this.instance)try{RTCLog.debug("[WebSocketClient]: old instance is not close! close it before create the new one!old readyState = "+this.instance.readyState+", old url = "+this.instance.url),this.instance.onclose=function(){},this.instance.close(WS_CLOSE_CODE.CLIENT_EXIT),this.instance=null}catch(e){RTCLog.error("[WebSocketClient]close last instance error: "+e.message)}this.trybkTimer=setTimeout(function(){n.hasConnect?RTCLog.debug("[WebSocketClient]setTimeout: ws has connected!"):(RTCLog.debug("[WebSocketClient]setTimeout, tryBkWS"),n.trybkurl())},1e3),this.instance=new WebSocket(e),this.instance.onopen=function(){var e=n;if(e.hasConnect)return void RTCLog.error("[WebSocketClient]main websocket open, open more than one!!");e.hasConnect=!0,RTCLog.debug("[WebSocketClient]main websocket wsopen"),null!=e.instancebk&&(e.instancebk.close(),e.instancebk=null),e.instance.onerror=function(e){RTCLog.error("[WebSocketClient]websocket wsonerror ",e),n.onerror(e)},e.instance.onclose=function(e){switch(RTCLog.error("[WebSocketClient]websocket wsonclose ",e),e.code){case WS_CLOSE_CODE.CLOSE_NORMAL:n.onclose(e);break;default:n.retryCount<=0?n.onclose(e):n.reconnect(e)}},e.retryCount=Constants.WS_MAX_RETRY_COUNT,RTCLog.debug("[WebSocketClient]web socket connect success",e),e.onopen()},this.instance.onerror=function(e){RTCLog.error("[WebSocketClient]main websocket init error, trybkurl",e);var t=n;t.hasConnect||(t.instance.close(WS_CLOSE_CODE.CLIENT_CONN_ERR),t.instance=null,n.trybkurl(),null==t.instance&&null==t.instancebk&&(RTCLog.error("[WebSocketClient]main and bk url connect failed",e),t.retryCount<=0?t.onerror(e):t.reconnect(e)))},this.instance.onclose=function(e){RTCLog.error("[WebSocketClient]main websocket init close",e)},this.instance.onmessage=function(e){n.onmessage(e)}},WebSocketClient.prototype.onopen=function(){RTCLog.debug("WebSocketClient : onopen ",arguments)},WebSocketClient.prototype.onmessage=function(e){},WebSocketClient.prototype.onerror=function(e){RTCLog.debug("WebSocketClient : onerror ",arguments)},WebSocketClient.prototype.onclose=function(e){RTCLog.debug("WebSocketClient : onclose",arguments)},WebSocketClient.prototype.close=function(){RTCLog.debug("[WebSocketClient --\x3e on close!]"),clearTimeout(this.reconnectTimer),clearTimeout(this.trybkTimer),this.instance&&(this.instance.close(WS_CLOSE_CODE.CLOSE_NORMAL),this.instance=null),this.hasConnect=!1,this.url=null,this.relayInfo={innerip:null,outterip:null,dataport:0,stunport:0},this.sessioninfo={openid:null,tinyid:null,srcids:[],peersdp:{}}},WebSocketClient.prototype.reconnect=function(){RTCLog.debug("websocketclient try reconnect!");var e=this;e.instance&&(e.instance=null),e.instancebk&&(e.instancebk=null);var t=Constants.WS_RETRY_DIST*(Constants.WS_MAX_RETRY_COUNT-e.retryCount+1);this.reconnectTimer=setTimeout(function(){if(e.retryCount<=0)return void e.close(WS_CLOSE_CODE.CLIENT_RECONN_FAIL);e.retryCount--,RTCLog.debug("websocketclient reconnecting,retryCount:"+e.retryCount);var t=e.url,n=e.bkurl;e.hasConnect&&-1==t.indexOf("rc=1")&&(t+="?rc=1",n+="?rc=1"),e.hasConnect=!1,e.usebkurl=!1,e.isbkurl=!1,e.bkurl?e.open(t,n):e.open(t)},t>3e3?t:3e3)},WebSocketClient.prototype.send=function(e){this.instance&&this.instance.readyState==this.instance.OPEN&&this.instance.send(e)},WebSocketClient.prototype.replaceURLValue=function(url,paramName,replaceWith){var re=eval("/("+paramName+"=)([^&]*)/gi");return url.replace(re,paramName+"="+replaceWith)},module.exports=WebSocketClient}])});
} IMWEB_WEBPACK_JS_ONLOAD('WebRTCAPI_edu_v1');